<!DOCTYPE HTML>
<html>
<head>
    <title>Flask-SocketIO Test</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>

</head>
<body>

<img src="/static/dratuti.jpg">

<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.9&appId=1498634080177915";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

 window.fbAsyncInit = function() {
     FB.init({
    appId      : '1498634080177915',
    status     : true,
    xfbml      : true,
    version    : 'v2.9' // or v2.6, v2.5, v2.4, v2.3
  });
    FB.AppEvents.logPageView();


FB.getLoginStatus(function(response) {
  if (response.status === 'connected') {
    // the user is logged in and has authenticated your
    // app, and response.authResponse supplies
    // the user's ID, a valid access token, a signed
    // request, and the time the access token
    // and signed request each expire
    var uid = response.authResponse.userID;
    var accessToken = response.authResponse.accessToken;
    console.log('response.authResponse.accessToken:' + response.authResponse.accessToken)
    var socket = io.connect('ws://127.0.0.1:5000');
            socket.on('connect', function() {
                socket.emit('/api/v1/login', String(response.authResponse.accessToken), function(data) {
                console.log('resonse:' + data)})
            });


  } else if (response.status === 'not_authorized') {
    // the user is logged in to Facebook,
    // but has not authenticated your app
  } else {
    // the user isn't logged in to Facebook.
  }
 });

  };

</script>

<div class="fb-login-button" data-max-rows="1" data-size="large" data-button-type="continue_with"
     data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false"></div>

</body>
</html>
